<!DOCTYPE html>
<html lang="ja">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>WordStock</title>
Â  Â  <style>
Â  Â  Â  Â  :root { --primary: #007bff; --success: #28a745; --bg: #f0f2f5; --text: #333; }
Â  Â  Â  Â  body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 15px; color: var(--text); line-height: 1.5; }
Â  Â  Â  Â  .container { max-width: 500px; margin: 0 auto; }
Â  Â  Â  Â  .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.08); margin-bottom: 20px; }
Â  Â  Â  Â  h1 { font-size: 1.2rem; text-align: center; color: #555; margin-bottom: 20px; }
Â  Â  Â  Â  .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1rem; transition: 0.2s; }
Â  Â  Â  Â  .btn-sync { background: #6f42c1; color: white; margin-bottom: 15px; box-shadow: 0 4px 0 #5634a1; }
Â  Â  Â  Â  .btn-sync:active { transform: translateY(2px); box-shadow: none; }
Â  Â  Â  Â  .btn-main { background: var(--primary); color: white; }
Â  Â  Â  Â  #quiz-area { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a1a1a; color: white; z-index: 1000; padding: 25px; box-sizing: border-box; overflow-y: auto; }
Â  Â  Â  Â  .quiz-card { text-align: center; margin-top: 20px; }
Â  Â  Â  Â  .q-word { font-size: 2.8rem; font-weight: bold; margin: 10px 0; color: #fff; }
Â  Â  Â  Â  .answer-box { display: none; background: #2d2d2d; padding: 20px; border-radius: 12px; text-align: left; border-left: 5px solid var(--primary); }
Â  Â  Â  Â  .highlight { color: #ffd700; font-weight: bold; }
Â  Â  Â  Â  .choice-group { display: flex; gap: 15px; margin-top: 30px; display: none; }
Â  Â  Â  Â  /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.add-card {Â 
Â  Â  background: #ffffff;Â 
Â  Â  border-radius: 15px;Â 
Â  Â  overflow: hidden;Â 
Â  Â  margin-bottom: 20px;Â 
Â  Â  border: 1px solid #e0e4e8;
}

/* ã‚¿ãƒƒãƒ—ã—ã¦é–‹é–‰ã™ã‚‹ãƒ˜ãƒƒãƒ€ãƒ¼ */
.add-header {
Â  Â  background: #f8f9fa;
Â  Â  padding: 15px 20px;
Â  Â  display: flex;
Â  Â  justify-content: space-between;
Â  Â  align-items: center;
Â  Â  cursor: pointer;
Â  Â  font-weight: bold;
Â  Â  color: #555;
}

/* å…¥åŠ›ã‚¨ãƒªã‚¢ã®ä¸­èº« */
.add-body {
Â  Â  padding: 20px;
Â  Â  display: none; /* æœ€åˆã¯éš ã™ */
Â  Â  border-top: 1px solid #eee;
}

/* å…¥åŠ›æ¬„ã®ãƒ‡ã‚¶ã‚¤ãƒ³å‘ä¸Š */
.input-group { margin-bottom: 15px; }
.input-group label {Â 
Â  Â  display: block;Â 
Â  Â  font-size: 0.85rem;Â 
Â  Â  color: #888;Â 
Â  Â  margin-bottom: 5px;Â 
Â  Â  margin-left: 5px;
}

input[type="text"], textarea {
Â  Â  width: 100%;
Â  Â  padding: 12px;
Â  Â  border: 1px solid #dee2e6;
Â  Â  border-radius: 10px;
Â  Â  background: #fcfcfc;
Â  Â  font-size: 16px;
Â  Â  transition: 0.3s;
}

input[type="text"]:focus, textarea:focus {
Â  Â  outline: none;
Â  Â  border-color: var(--primary);
Â  Â  background: #fff;
Â  Â  box-shadow: 0 0 0 4px rgba(0,123,255,0.1);
}
Â  Â  </style>
</head>
<body>

<div class="container">
Â  Â  <h1>ğŸ“š WordStock </h1>
Â  Â <div class="add-card">
Â  Â  <div class="add-header" onclick="toggleAddForm()">
Â  Â  Â  Â  <span>è‡ªåˆ†ã§å˜èªã‚’è¿½åŠ </span>
Â  Â  Â  Â  <span id="add-icon">ï¼‹</span>
Â  Â  </div>
Â  Â Â 
Â  Â  <div id="add-body" class="add-body">
Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <label>è‹±å˜èª</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="word" placeholder="ä¾‹: apple">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <label>æ„å‘³</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="meaning" placeholder="ä¾‹: ã‚Šã‚“ã”">
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div style="display: flex; gap: 10px;">
Â  Â  Â  Â  Â  Â  <div class="input-group" style="flex: 1;">
Â  Â  Â  Â  Â  Â  Â  Â  <label>å“è©</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="type" placeholder="åè©">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="input-group" style="flex: 1;">
Â  Â  Â  Â  Â  Â  Â  Â  <label>ç™ºéŸ³</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="pronunciation" placeholder="Ã¦pl">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <label>ä¾‹æ–‡</label>
Â  Â  Â  Â  Â  Â  <textarea id="sentence" rows="2" placeholder="I like apples."></textarea>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <label>ãƒ¡ãƒ¢ãƒ»è§£èª¬</label>
Â  Â  Â  Â  Â  Â  <textarea id="advice" rows="2" placeholder="èªæºã‚„è¦šãˆæ–¹ã®ã‚³ãƒ„"></textarea>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <button class="btn" style="background: var(--success); color: white;" onclick="saveWord()">
Â  Â  Â  Â  Â  Â  ã‚¹ãƒãƒ›ã«ä¿å­˜ã™ã‚‹
Â  Â  Â  Â  </button>
Â  Â  </div>
</div>
Â  Â  </div>
Â  Â  <button class="btn btn-sync" onclick="syncFromSheet()">å˜èªã‚’å–ã‚Šè¾¼ã‚€</button>
Â  Â  <div class="card" style="text-align:center;">
Â  Â  Â  Â  <h2 id="review-count">ä»Šæ—¥ã®å¾©ç¿’: 0 èª</h2>
Â  Â  Â  Â  <button class="btn btn-main" onclick="startReview()">å¾©ç¿’é–‹å§‹</button>
Â  Â  </div>
</div>

<div id="quiz-area">
Â  Â  <div class="quiz-card">
Â  Â  Â  Â  <div id="q-type-label" style="font-size:0.9rem; color:var(--primary)"></div>
Â  Â  Â  Â  <div id="q-word" class="q-word"></div>
Â  Â  Â  Â  <div id="q-pron" style="color:#aaa; margin-bottom:20px;"></div>
Â  Â  Â  Â  <button id="show-ans-btn" class="btn btn-main" onclick="showAnswer()">ç­”ãˆã‚’è¦‹ã‚‹</button>
Â  Â  Â  Â  <div id="answer-box" class="answer-box">
Â  Â  Â  Â  Â  Â  <p><strong>æ„å‘³:</strong> <span id="q-meaning" style="font-size:1.2rem;"></span></p>
Â  Â  Â  Â  Â  Â  <p><strong>ä¾‹æ–‡:</strong> <br><span id="q-sentence" style="font-style:italic; color:#ddd;"></span></p>
Â  Â  Â  Â  Â  Â  <p><strong>è§£èª¬:</strong> <br><span id="q-advice" class="highlight"></span></p>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="choice-group" class="choice-group">
Â  Â  Â  Â  Â  Â  <button class="btn" style="background:#dc3545; color:white; flex:1;" onclick="submitResult(false)">å¿˜ã‚ŒãŸ</button>
Â  Â  Â  Â  Â  Â  <button class="btn" style="background:#28a745; color:white; flex:1;" onclick="submitResult(true)">è¦šãˆãŸ</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button class="btn" style="background:transparent; color:#666; margin-top:20px;" onclick="closeQuiz()">ä¸­æ–­</button>
Â  Â  </div>
</div>

<script>
Â  Â  function saveWord() {
Â  Â  Â  Â  const word = document.getElementById('word').value;
Â  Â  Â  Â  const meaning = document.getElementById('meaning').value;
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (!word || !meaning) return alert("å˜èªã¨æ„å‘³ã¯å¿…é ˆã§ã™");

Â  Â  Â  Â  const data = {
Â  Â  Â  Â  Â  Â  level: "è‡ªç¿’", // æ‰‹å‹•è¿½åŠ åˆ†ã¨ã‚ã‹ã‚‹ã‚ˆã†ã«
Â  Â  Â  Â  Â  Â  type: document.getElementById('type').value,
Â  Â  Â  Â  Â  Â  word: word.trim(),
Â  Â  Â  Â  Â  Â  pronunciation: document.getElementById('pronunciation').value,
Â  Â  Â  Â  Â  Â  meaning: meaning,
Â  Â  Â  Â  Â  Â  sentence: document.getElementById('sentence').value,
Â  Â  Â  Â  Â  Â  advice: document.getElementById('advice').value,
Â  Â  Â  Â  Â  Â  nextReview: new Date().toISOString().split('T')[0],
Â  Â  Â  Â  Â  Â  interval: 0
Â  Â  Â  Â  };

Â  Â  Â  Â  myVocab.push(data);
Â  Â  Â  Â  localStorage.setItem('my_vocab_data', JSON.stringify(myVocab));
Â  Â  Â  Â Â 
Â  Â  Â  Â  // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢
Â  Â  Â  Â  document.querySelectorAll('input, textarea').forEach(el => el.value = "");
Â  Â  Â  Â Â 
Â  Â  Â  Â  alert("å˜èªã‚’ä¿å­˜ã—ã¾ã—ãŸï¼");
Â  Â  Â  Â  updateDisplay();
Â  Â  }
Â  Â  let myVocab = JSON.parse(localStorage.getItem('my_vocab_data')) || [];
Â  Â  let quizList = [];
Â  Â  let currentIdx = 0;

Â  Â  function updateDisplay() {
Â  Â  Â  Â  const today = new Date().toISOString().split('T')[0];
Â  Â  Â  Â  const due = myVocab.filter(v => !v.nextReview || v.nextReview <= today);
Â  Â  Â  Â  document.getElementById('review-count').innerText = `ä»Šæ—¥ã®å¾©ç¿’: ${due.length} èª`;
Â  Â  }
Â  Â  updateDisplay();

async function syncFromSheet() {
    const sheetId = "18XxJwzl4sF3_kHJp8qk-QUUfvsqMM3AyJNKdWmyUFUE";
    const sheetUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv`;
    
    try {
        const res = await fetch(sheetUrl);
        if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
        
        const csv = await res.text();
        // 1ã¤ã®ã‚»ãƒ«å†…ã«ã‚ã‚‹æ”¹è¡Œã‚’ä¿è­·ã—ã¤ã¤ã€è¡Œã”ã¨ã«åˆ†å‰²
        const rows = csv.split(/\r?\n(?=(?:(?:[^"]*"){2})*[^"]*$)/).slice(1); 
        let count = 0;
        
        rows.forEach(line => {
            if (!line.trim()) return;
            
            // ã‚«ãƒ³ãƒã§åˆ†å‰²ï¼ˆå¼•ç”¨ç¬¦å†…ã®ã‚«ãƒ³ãƒã¯ç„¡è¦–ï¼‰
            const cols = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            const clean = (s) => s ? s.replace(/^"|"$/g, '').trim() : "";
            
            // ã‚·ãƒ¼ãƒˆã®æ§‹æˆ  ã«åˆã‚ã›ã¦æŠ½å‡º
            if (cols.length >= 3) {
                const rawWordData = clean(cols[2]); // 3åˆ—ç›®: å˜èª / ç™ºéŸ³
                const wordParts = rawWordData.split(/\n/); // ã‚»ãƒ«å†…ã®æ”¹è¡Œã§åˆ†ã‘ã‚‹
                
                const word = wordParts[0].trim(); // 1è¡Œç›®ã‚’å˜èªã¨ã™ã‚‹
                // 2è¡Œç›®ä»¥é™ãŒã‚ã‚Œã°ç™ºéŸ³ã¨ã—ã¦çµåˆã€ãªã‘ã‚Œã°ç©º
                const pron = wordParts.slice(1).join(' ').trim(); 

                if (word && !myVocab.some(v => v.word.toLowerCase() === word.toLowerCase())) {
                    myVocab.push({
                        level: clean(cols[0]),         // 1åˆ—ç›®: ãƒ¬ãƒ™ãƒ« 
                        type: clean(cols[1]),          // 2åˆ—ç›®: å“è©/å±æ€§ 
                        word: word,
                        pronunciation: pron,           // ã‚»ãƒ«å†…ã‹ã‚‰æŠ½å‡ºã—ãŸç™ºéŸ³ 
                        meaning: clean(cols[3]),       // 4åˆ—ç›®: æ„å‘³ 
                        sentence: clean(cols[4]),      // 5åˆ—ç›®: çŸ­ã„è‹±æ–‡ã¨å’Œè¨³ 
                        advice: clean(cols[5]),        // 6åˆ—ç›®: è¦šãˆã‚‹ã‚¢ãƒ‰ãƒã‚¤ã‚¹ 
                        nextReview: new Date().toISOString().split('T')[0],
                        interval: 0
                    });
                    count++;
                }
            }
        });
        
        localStorage.setItem('my_vocab_data', JSON.stringify(myVocab));
        alert(`âœ… ${count}ä»¶ã®æ–°ã—ã„å˜èªï¼ˆå®Ÿé¨“ã‚·ãƒ¼ãƒˆï¼‰ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼`);
        updateDisplay();
        
    } catch (e) {
        console.error('åŒæœŸã‚¨ãƒ©ãƒ¼:', e);
        alert("âš ï¸ åŒæœŸã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãŒã€ã‚¦ã‚§ãƒ–ã«å…¬é–‹ã€ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
    }
}

Â  Â  function startReview() {
Â  Â  Â  Â  const today = new Date().toISOString().split('T')[0];
Â  Â  Â  Â  quizList = myVocab.filter(v => !v.nextReview || v.nextReview <= today);
Â  Â  Â  Â  if (quizList.length === 0) return alert("å¾©ç¿’ãªã—ï¼");
Â  Â  Â  Â  currentIdx = 0;
Â  Â  Â  Â  document.getElementById('quiz-area').style.display = "block";
Â  Â  Â  Â  showQuestion();
Â  Â  }
Â  Â  function showQuestion() {
Â  Â  Â  Â  const q = quizList[currentIdx];
Â  Â  Â  Â  document.getElementById('q-word').innerText = q.word;
Â  Â  Â  Â  document.getElementById('q-type-label').innerText = `[${q.level}] ${q.type}`;
Â  Â  Â  Â  document.getElementById('q-pron').innerText = q.pronunciation ? `[ ${q.pronunciation} ]` : "";
Â  Â  Â  Â  document.getElementById('q-meaning').innerText = q.meaning;
Â  Â  Â  Â  document.getElementById('q-sentence').innerText = q.sentence;
Â  Â  Â  Â  document.getElementById('q-advice').innerText = q.advice;
Â  Â  Â  Â  document.getElementById('answer-box').style.display = "none";
Â  Â  Â  Â  document.getElementById('choice-group').style.display = "none";
Â  Â  Â  Â  document.getElementById('show-ans-btn').style.display = "block";
Â  Â  }
Â  Â  function showAnswer() {
Â  Â  Â  Â  document.getElementById('answer-box').style.display = "block";
Â  Â  Â  Â  document.getElementById('choice-group').style.display = "flex";
Â  Â  Â  Â  document.getElementById('show-ans-btn').style.display = "none";
Â  Â  }
Â  Â  function submitResult(isCorrect) {
Â  Â  Â  Â  const target = myVocab.find(v => v.word === quizList[currentIdx].word);
Â  Â  Â  Â  if(isCorrect) { target.interval = (target.interval === 0) ? 1 : target.interval * 2; }
Â  Â  Â  Â  else { target.interval = 0; }
Â  Â  Â  Â  let next = new Date();
Â  Â  Â  Â  next.setDate(next.getDate() + (isCorrect ? target.interval : 0));
Â  Â  Â  Â  target.nextReview = next.toISOString().split('T')[0];
Â  Â  Â  Â  localStorage.setItem('my_vocab_data', JSON.stringify(myVocab));
Â  Â  Â  Â  currentIdx++;
Â  Â  Â  Â  if(currentIdx < quizList.length) showQuestion();
Â  Â  Â  Â  else { alert("å®Œäº†ï¼"); closeQuiz(); }
Â  Â  }
Â  Â  function closeQuiz() { document.getElementById('quiz-area').style.display = "none"; updateDisplay(); }
Â  Â  function toggleAddForm() {
Â  Â  const body = document.getElementById('add-body');
Â  Â  const icon = document.getElementById('add-icon');
Â  Â  if (body.style.display === "block") {
Â  Â  Â  Â  body.style.display = "none";
Â  Â  Â  Â  icon.innerText = "ï¼‹";
Â  Â  } else {
Â  Â  Â  Â  body.style.display = "block";
Â  Â  Â  Â  icon.innerText = "ãƒ¼";
Â  Â  }
}
</script>
</body>

</html>

