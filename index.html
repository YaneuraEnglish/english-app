<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Vocab Sync - å±‹æ ¹è£è‹±èª</title>
    <style>
        :root { --primary: #007bff; --success: #28a745; --bg: #f0f2f5; --text: #333; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 15px; color: var(--text); line-height: 1.5; }
        .container { max-width: 500px; margin: 0 auto; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.08); margin-bottom: 20px; }
        h1 { font-size: 1.2rem; text-align: center; color: #555; margin-bottom: 20px; }
        h2 { font-size: 1rem; margin-top: 0; color: #777; border-bottom: 1px solid #eee; padding-bottom: 8px; }
        
        /* ãƒœã‚¿ãƒ³ãƒ»å…¥åŠ›UI */
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1rem; transition: 0.2s; }
        .btn-sync { background: #6f42c1; color: white; margin-bottom: 15px; box-shadow: 0 4px 0 #5634a1; }
        .btn-sync:active { transform: translateY(2px); box-shadow: none; }
        .btn-main { background: var(--primary); color: white; }
        
        /* ã‚¯ã‚¤ã‚ºç”»é¢ */
        #quiz-area { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a1a1a; color: white; z-index: 1000; padding: 25px; box-sizing: border-box; overflow-y: auto; }
        .quiz-card { text-align: center; margin-top: 20px; }
        .q-word { font-size: 2.8rem; font-weight: bold; margin: 10px 0; color: #fff; }
        .q-sub { color: #aaa; font-size: 1.1rem; margin-bottom: 30px; }
        .answer-box { display: none; background: #2d2d2d; padding: 20px; border-radius: 12px; text-align: left; border-left: 5px solid var(--primary); }
        .highlight { color: #ffd700; font-weight: bold; }
        .choice-group { display: flex; gap: 15px; margin-top: 30px; display: none; }
        .btn-forget { background: #dc3545; color: white; flex: 1; }
        .btn-know { background: var(--success); color: white; flex: 1; }
    </style>
</head>
<body>

<div class="container" id="main-view">
    <h1>ğŸ“š å±‹æ ¹è£è‹±èª Vocab Sync</h1>

    <button class="btn btn-sync" onclick="syncFromSheet()">ğŸ”„ å…ˆç”Ÿã®æœ€æ–°å˜èªã‚’å–ã‚Šè¾¼ã‚€</button>

    <div class="card" style="text-align:center;">
        <h2 id="review-count">ä»Šæ—¥ã®å¾©ç¿’: 0 èª</h2>
        <button class="btn btn-main" onclick="startReview()">å¾©ç¿’ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°é–‹å§‹</button>
    </div>

    <div class="card">
        <p style="font-size: 0.8rem; color: #999;">â€»å…ˆç”ŸãŒã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’æ›´æ–°ã—ãŸã‚‰ã€Œå–ã‚Šè¾¼ã‚€ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
    </div>
</div>

<div id="quiz-area">
    <div class="quiz-card">
        <div id="q-type-label" style="font-size:0.9rem; color:var(--primary)"></div>
        <div id="q-word" class="q-word"></div>
        <div id="q-pron" class="q-sub"></div>
        
        <button id="show-ans-btn" class="btn btn-main" onclick="showAnswer()">ç­”ãˆã‚’è¦‹ã‚‹</button>
        
        <div id="answer-box" class="answer-box">
            <p><strong>æ„å‘³:</strong> <span id="q-meaning" style="font-size:1.2rem; color:white;"></span></p>
            <p><strong>è‹±æ–‡:</strong> <br><span id="q-sentence" style="font-style:italic; color:#ddd;"></span></p>
            <p><strong>æ ¸å¿ƒè§£èª¬:</strong> <br><span id="q-advice" class="highlight"></span></p>
        </div>

        <div id="choice-group" class="choice-group">
            <button class="btn btn-forget" onclick="submitResult(false)">å¿˜ã‚ŒãŸ</button>
            <button class="btn btn-know" onclick="submitResult(true)">è¦šãˆãŸ</button>
        </div>
        
        <button class="btn" style="background:transparent; color:#666; margin-top:20px;" onclick="closeQuiz()">ä¸­æ–­ã™ã‚‹</button>
    </div>
</div>

<script>
    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—
    let myVocab = JSON.parse(localStorage.getItem('my_vocab_data')) || [];
    let quizList = [];
    let currentIdx = 0;

    // ç”»é¢è¡¨ç¤ºæ›´æ–°
    function updateDisplay() {
        const today = new Date().toISOString().split('T')[0];
        const due = myVocab.filter(v => !v.nextReview || v.nextReview <= today);
        document.getElementById('review-count').innerText = `ä»Šæ—¥ã®å¾©ç¿’: ${due.length} èª`;
    }
    updateDisplay();

    // â˜… å…ˆç”Ÿã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    async function syncFromSheet() {
        // æ–°ã—ã„ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’é©ç”¨
        const sheetId = "1IrX_Uwr9hx2LLL-Irt-KQRR_FFk_LQpT8EF0WytWTAokoOd0dPBF4e4PiW3KjPz3kZEHWbHIqTWTJ";
        const sheetUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv`;
        
        try {
            const res = await fetch(sheetUrl);
            if (!res.ok) throw new Error('é€šä¿¡ã‚¨ãƒ©ãƒ¼');
            const csv = await res.text();
            
            const lines = csv.split(/\r?\n/).slice(1); // 1è¡Œç›®ã¯ãƒ˜ãƒƒãƒ€ãƒ¼
            let count = 0;

            lines.forEach(line => {
                // CSVåˆ†å‰²ï¼ˆã‚«ãƒ³ãƒå¯¾å¿œï¼‰
                const cols = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                const clean = (s) => s ? s.replace(/^"|"$/g, '').trim() : "";

                if (cols.length >= 3 && clean(cols[2])) {
                    const w = clean(cols[2]);
                    // é‡è¤‡ç™»éŒ²ã‚’é˜²ã
                    if (!myVocab.some(v => v.word === w)) {
                        myVocab.push({
                            level: clean(cols[0]), 
                            type: clean(cols[1]), 
                            word: w, 
                            pronunciation: clean(cols[3]),
                            meaning: clean(cols[4]), 
                            sentence: clean(cols[5]), 
                            advice: clean(cols[6]),
                            nextReview: new Date().toISOString().split('T')[0], 
                            interval: 0
                        });
                        count++;
                    }
                }
            });

            localStorage.setItem('my_vocab_data', JSON.stringify(myVocab));
            updateDisplay();
            alert(`${count}ä»¶ã®æ–°ã—ã„å˜èªã‚’è¿½åŠ ã—ã¾ã—ãŸï¼`);
        } catch (e) {
            console.error(e);
            alert("åŒæœŸã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãŒã€ã‚¦ã‚§ãƒ–ã«å…¬é–‹ã€ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
        }
    }

    // å­¦ç¿’æ©Ÿèƒ½
    function startReview() {
        const today = new Date().toISOString().split('T')[0];
        quizList = myVocab.filter(v => !v.nextReview || v.nextReview <= today);
        if (quizList.length === 0) return alert("ç¾åœ¨ã®å¾©ç¿’å¯¾è±¡ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚");
        currentIdx = 0;
        document.getElementById('quiz-area').style.display = "block";
        showQuestion();
    }

    function showQuestion() {
        const q = quizList[currentIdx];
        document.getElementById('q-word').innerText = q.word;
        document.getElementById('q-type-label').innerText = `[${q.level}] ${q.type}`;
        document.getElementById('q-pron').innerText = q.pronunciation ? `[ ${q.pronunciation} ]` : "";
        document.getElementById('q-meaning').innerText = q.meaning;
        document.getElementById('q-sentence').innerText = q.sentence;
        document.getElementById('q-advice').innerText = q.advice;
        
        document.getElementById('answer-box').style.display = "none";
        document.getElementById('choice-group').style.display = "none";
        document.getElementById('show-ans-btn').style.display = "block";
    }

    function showAnswer() {
        document.getElementById('answer-box').style.display = "block";
        document.getElementById('choice-group').style.display = "flex";
        document.getElementById('show-ans-btn').style.display = "none";
    }

    function submitResult(isCorrect) {
        const target = myVocab.find(v => v.word === quizList[currentIdx].word);
        if(isCorrect) {
            target.interval = (target.interval === 0) ? 1 : target.interval * 2;
        } else {
            target.interval = 0;
        }
        let next = new Date();
        next.setDate(next.getDate() + (isCorrect ? target.interval : 0));
        target.nextReview = next.toISOString().split('T')[0];

        localStorage.setItem('my_vocab_data', JSON.stringify(myVocab));
        
        currentIdx++;
        if(currentIdx < quizList.length) showQuestion();
        else {
            alert("ã™ã¹ã¦ã®å¾©ç¿’ãŒçµ‚ã‚ã‚Šã¾ã—ãŸï¼");
            closeQuiz();
        }
    }

    function closeQuiz() {
        document.getElementById('quiz-area').style.display = "none";
        updateDisplay();
    }
</script>
</body>
</html><!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Vocab Sync - å±‹æ ¹è£è‹±èª</title>
    <style>
        :root { --primary: #007bff; --success: #28a745; --bg: #f0f2f5; --text: #333; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 15px; color: var(--text); line-height: 1.5; }
        .container { max-width: 500px; margin: 0 auto; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.08); margin-bottom: 20px; }
        h1 { font-size: 1.2rem; text-align: center; color: #555; margin-bottom: 20px; }
        h2 { font-size: 1rem; margin-top: 0; color: #777; border-bottom: 1px solid #eee; padding-bottom: 8px; }
        
        /* ãƒœã‚¿ãƒ³ãƒ»å…¥åŠ›UI */
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1rem; transition: 0.2s; }
        .btn-sync { background: #6f42c1; color: white; margin-bottom: 15px; box-shadow: 0 4px 0 #5634a1; }
        .btn-sync:active { transform: translateY(2px); box-shadow: none; }
        .btn-main { background: var(--primary); color: white; }
        
        /* ã‚¯ã‚¤ã‚ºç”»é¢ */
        #quiz-area { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a1a1a; color: white; z-index: 1000; padding: 25px; box-sizing: border-box; overflow-y: auto; }
        .quiz-card { text-align: center; margin-top: 20px; }
        .q-word { font-size: 2.8rem; font-weight: bold; margin: 10px 0; color: #fff; }
        .q-sub { color: #aaa; font-size: 1.1rem; margin-bottom: 30px; }
        .answer-box { display: none; background: #2d2d2d; padding: 20px; border-radius: 12px; text-align: left; border-left: 5px solid var(--primary); }
        .highlight { color: #ffd700; font-weight: bold; }
        .choice-group { display: flex; gap: 15px; margin-top: 30px; display: none; }
        .btn-forget { background: #dc3545; color: white; flex: 1; }
        .btn-know { background: var(--success); color: white; flex: 1; }
    </style>
</head>
<body>

<div class="container" id="main-view">
    <h1>ğŸ“š å±‹æ ¹è£è‹±èª Vocab Sync</h1>

    <button class="btn btn-sync" onclick="syncFromSheet()">ğŸ”„ å…ˆç”Ÿã®æœ€æ–°å˜èªã‚’å–ã‚Šè¾¼ã‚€</button>

    <div class="card" style="text-align:center;">
        <h2 id="review-count">ä»Šæ—¥ã®å¾©ç¿’: 0 èª</h2>
        <button class="btn btn-main" onclick="startReview()">å¾©ç¿’ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°é–‹å§‹</button>
    </div>

    <div class="card">
        <p style="font-size: 0.8rem; color: #999;">â€»å…ˆç”ŸãŒã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’æ›´æ–°ã—ãŸã‚‰ã€Œå–ã‚Šè¾¼ã‚€ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
    </div>
</div>

<div id="quiz-area">
    <div class="quiz-card">
        <div id="q-type-label" style="font-size:0.9rem; color:var(--primary)"></div>
        <div id="q-word" class="q-word"></div>
        <div id="q-pron" class="q-sub"></div>
        
        <button id="show-ans-btn" class="btn btn-main" onclick="showAnswer()">ç­”ãˆã‚’è¦‹ã‚‹</button>
        
        <div id="answer-box" class="answer-box">
            <p><strong>æ„å‘³:</strong> <span id="q-meaning" style="font-size:1.2rem; color:white;"></span></p>
            <p><strong>è‹±æ–‡:</strong> <br><span id="q-sentence" style="font-style:italic; color:#ddd;"></span></p>
            <p><strong>æ ¸å¿ƒè§£èª¬:</strong> <br><span id="q-advice" class="highlight"></span></p>
        </div>

        <div id="choice-group" class="choice-group">
            <button class="btn btn-forget" onclick="submitResult(false)">å¿˜ã‚ŒãŸ</button>
            <button class="btn btn-know" onclick="submitResult(true)">è¦šãˆãŸ</button>
        </div>
        
        <button class="btn" style="background:transparent; color:#666; margin-top:20px;" onclick="closeQuiz()">ä¸­æ–­ã™ã‚‹</button>
    </div>
</div>

<script>
    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—
    let myVocab = JSON.parse(localStorage.getItem('my_vocab_data')) || [];
    let quizList = [];
    let currentIdx = 0;

    // ç”»é¢è¡¨ç¤ºæ›´æ–°
    function updateDisplay() {
        const today = new Date().toISOString().split('T')[0];
        const due = myVocab.filter(v => !v.nextReview || v.nextReview <= today);
        document.getElementById('review-count').innerText = `ä»Šæ—¥ã®å¾©ç¿’: ${due.length} èª`;
    }
    updateDisplay();

    // â˜… å…ˆç”Ÿã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    async function syncFromSheet() {
        // æ–°ã—ã„ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’é©ç”¨
        const sheetId = "1IrX_Uwr9hx2LLL-Irt-KQRR_FFk_LQpT8EF0WytWTAokoOd0dPBF4e4PiW3KjPz3kZEHWbHIqTWTJ";
        const sheetUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv`;
        
        try {
            const res = await fetch(sheetUrl);
            if (!res.ok) throw new Error('é€šä¿¡ã‚¨ãƒ©ãƒ¼');
            const csv = await res.text();
            
            const lines = csv.split(/\r?\n/).slice(1); // 1è¡Œç›®ã¯ãƒ˜ãƒƒãƒ€ãƒ¼
            let count = 0;

            lines.forEach(line => {
                // CSVåˆ†å‰²ï¼ˆã‚«ãƒ³ãƒå¯¾å¿œï¼‰
                const cols = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                const clean = (s) => s ? s.replace(/^"|"$/g, '').trim() : "";

                if (cols.length >= 3 && clean(cols[2])) {
                    const w = clean(cols[2]);
                    // é‡è¤‡ç™»éŒ²ã‚’é˜²ã
                    if (!myVocab.some(v => v.word === w)) {
                        myVocab.push({
                            level: clean(cols[0]), 
                            type: clean(cols[1]), 
                            word: w, 
                            pronunciation: clean(cols[3]),
                            meaning: clean(cols[4]), 
                            sentence: clean(cols[5]), 
                            advice: clean(cols[6]),
                            nextReview: new Date().toISOString().split('T')[0], 
                            interval: 0
                        });
                        count++;
                    }
                }
            });

            localStorage.setItem('my_vocab_data', JSON.stringify(myVocab));
            updateDisplay();
            alert(`${count}ä»¶ã®æ–°ã—ã„å˜èªã‚’è¿½åŠ ã—ã¾ã—ãŸï¼`);
        } catch (e) {
            console.error(e);
            alert("åŒæœŸã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãŒã€ã‚¦ã‚§ãƒ–ã«å…¬é–‹ã€ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
        }
    }

    // å­¦ç¿’æ©Ÿèƒ½
    function startReview() {
        const today = new Date().toISOString().split('T')[0];
        quizList = myVocab.filter(v => !v.nextReview || v.nextReview <= today);
        if (quizList.length === 0) return alert("ç¾åœ¨ã®å¾©ç¿’å¯¾è±¡ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚");
        currentIdx = 0;
        document.getElementById('quiz-area').style.display = "block";
        showQuestion();
    }

    function showQuestion() {
        const q = quizList[currentIdx];
        document.getElementById('q-word').innerText = q.word;
        document.getElementById('q-type-label').innerText = `[${q.level}] ${q.type}`;
        document.getElementById('q-pron').innerText = q.pronunciation ? `[ ${q.pronunciation} ]` : "";
        document.getElementById('q-meaning').innerText = q.meaning;
        document.getElementById('q-sentence').innerText = q.sentence;
        document.getElementById('q-advice').innerText = q.advice;
        
        document.getElementById('answer-box').style.display = "none";
        document.getElementById('choice-group').style.display = "none";
        document.getElementById('show-ans-btn').style.display = "block";
    }

    function showAnswer() {
        document.getElementById('answer-box').style.display = "block";
        document.getElementById('choice-group').style.display = "flex";
        document.getElementById('show-ans-btn').style.display = "none";
    }

    function submitResult(isCorrect) {
        const target = myVocab.find(v => v.word === quizList[currentIdx].word);
        if(isCorrect) {
            target.interval = (target.interval === 0) ? 1 : target.interval * 2;
        } else {
            target.interval = 0;
        }
        let next = new Date();
        next.setDate(next.getDate() + (isCorrect ? target.interval : 0));
        target.nextReview = next.toISOString().split('T')[0];

        localStorage.setItem('my_vocab_data', JSON.stringify(myVocab));
        
        currentIdx++;
        if(currentIdx < quizList.length) showQuestion();
        else {
            alert("ã™ã¹ã¦ã®å¾©ç¿’ãŒçµ‚ã‚ã‚Šã¾ã—ãŸï¼");
            closeQuiz();
        }
    }

    function closeQuiz() {
        document.getElementById('quiz-area').style.display = "none";
        updateDisplay();
    }
</script>
</body>
</html>